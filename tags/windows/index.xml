<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Simply Patrick </title>
    <link>https://blog.simplypatrick.com/tags/windows/</link>
    <author>Patrick Tsai</author>
    <rights>Copyright (c) 2003 - 2016, Patrick Tsai; all rights reserved.</rights>
    <updated>2006-10-31 00:00:00 &#43;0000 UTC</updated>
    
    <item>
      <title>Windows 1.0</title>
      <link>https://blog.simplypatrick.com/posts/2006/2006-10-31-358/</link>
      <pubDate>Tue, 31 Oct 2006 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2006/2006-10-31-358/</guid>
      <description>&lt;iframe width=&#34;420&#34; height=&#34;315&#34; src=&#34;//www.youtube.com/embed/W6YgZc5th6g&#34; frameborder=&#34;0&#34; allowfullscreen&gt;&lt;/iframe&gt;
&lt;p&gt;這&amp;hellip; 真的是 &lt;a href=&#34;//www.microsoft.com/presspass/exec/steve/default.mspx&#34;&gt;Steve Ballmer&lt;/a&gt; 嗎？&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Windows Internals Guru - Mark Russinovich</title>
      <link>https://blog.simplypatrick.com/posts/2005/2005-04-12-236/</link>
      <pubDate>Tue, 12 Apr 2005 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2005/2005-04-12-236/</guid>
      <description>&lt;p&gt;&lt;a href=&#34;http://www.sysinternals.com/blog/&#34;&gt;Mark Russinovich 也開始 blog 了&lt;/a&gt;。對 Windows 內部運作有興趣的人可以持續關注他的文章。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Comments in Windows Source Code</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-06-30-168/</link>
      <pubDate>Wed, 30 Jun 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-06-30-168/</guid>
      <description>&lt;p&gt;相信很多人看過流傳在網路上的 Windows 原始碼，有沒有注意到&lt;A href=&#34;http://www.kuro5hin.org/story/2004/2/15/71552/7795&#34;&gt;這些在原始碼裡的有趣註解&lt;/A&gt;？&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;private\shell\shell32\util.cpp:
// the fucking alpha cpp compiler seems to fuck up the goddam type
&amp;#34;LPITEMIDLIST&amp;#34;, so to work&amp;lt;BR&amp;gt;// around the fucking peice of shit compiler we
pass the last param as an void *instead of a LPITEMIDLIST

private\windows\media\avi\verinfo.16\verinfo.h:
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*       !!!!!!!IF YOU CHANGE TABS TO SPACES, YOU WILL BE KILLED!!!!!!!
*       !!!!!!!!!!!!!!DOING SO FUCKS THE BUILD PROCESS!!!!!!!!!!!!!!!!
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
*       !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

private\ntos\rtl\heap.c:
// The specific idiot in this case is Office95, which likes
// to free a random pointer when you start Word95 from a desktop
// shortcut.

private\ntos\w32\ntuser\kernel\swp.c:
* for idiots like MS-Access 2.0 who SetWindowPos( SWP_BOZO
* and blow away themselves on the shell, then lets
* just ignore their plea to be removed from the tray

private\ntos\w32\ntuser\kernel\swp.c:
* for idiots like MS-Access 2.0 who SetWindowPos( SWP_BOZO
* and blow away themselves on the shell, then lets
* just ignore their plea to be removed from the tray

private\inet\mshtml\src\core\cdbase\baseprop.cxx:
// HACK! HACK! HACK! (MohanB) In order to fix #64710 at this very late
private\inet\mshtml\src\core\cdutil\genutil.cxx:
// HACK HACK HACK. REMOVE THIS ONCE MARLETT IS AROUND

private\inet\mshtml\src\other\moniker\resprot.cxx:
//
goto EndHack;
//

private\inet\mshtml\src\site\layout\flowlyt.cxx:
// God, I hate this hack ...

private\inet\wininet\urlcache\cachecfg.cxx:
// Dumb hack for back compat. *sigh*

private\inet\wininet\urlcache\filemgr.cxx:
// ACHTUNG!!! this is a special hack for IBM antivirus software

private\ispu\pkitrust\trustui\acuictl.cpp:
// HACK ALERT, believe it or not there is no way to get the height of the current
// HACK ON TOP OF HACK ALERT,

private\ntos\udfs\devctrl.c:
// Add the hack-o-ramma to fix formats.

private\shell\shdoc401\unicpp\sendto.cpp:
// Mondo hackitude-o-rama.

private\ntos\w32\ntcon\server\link.c:
// HUGE, HUGE hack-o-rama to get NTSD started on this process!

private\ntos\w32\ntuser\client\dlgmgr.c:
// HACK OF DEATH:

private\shell\lib\util.cpp:
// TERRIBLE HORRIBLE NO GOOD VERY BAD HACK

private\ntos\w32\ntuser\client\nt6\user.h:
* The magnitude of this hack compares favorably with that of the national debt.
&lt;/code&gt;&lt;/pre&gt;</description>
    </item>
    
    <item>
      <title>Quit thinking and look</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-04-02-140/</link>
      <pubDate>Fri, 02 Apr 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-04-02-140/</guid>
      <description>&lt;p&gt;最近遇到了一個頗為難纏的 bug，症狀是當燒錄光碟的動作完成後，有些視窗的背景會變成黑色而不是原來的背景圖案；如果燒錄的資料量越大，這問題就越快出現；更奇怪的是這問題只會發生在安裝的版本而不是開發人員自己編譯出來的版本。&lt;/p&gt;
&lt;p&gt;根據 &lt;a href=&#34;http://www.debuggingrules.com/&#34;&gt;debugging rules&lt;/a&gt; 的第二條規則 &amp;ldquo;Make it fail&amp;rdquo;，最重要的事情是在開發人員的機器上重現這個問題。我們首先嘗試將開發人員編譯的執行碼來覆蓋安裝的版本，結果問題還是會發生；反之，用安裝版本來覆蓋開發人員編譯的執行碼也不會有問題。對於這樣的結果，我們感到相當困惑，因為如果不是程式碼造成的差異，那會是什麼因素造成這樣的結果？&lt;/p&gt;
&lt;p&gt;根據 rule 3 &amp;ldquo;Quit thinking and look&amp;rdquo;，我們決定多做一點嘗試，完整複製整個環境而不是只有執行碼。花了一番功夫，我們發現居然是執行檔 manifest 的問題，關鍵在於 manifest 中的這一段：&lt;/p&gt;
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code class=&#34;language-markup&#34; data-lang=&#34;markup&#34;&gt;&amp;lt;dependentAssembly&amp;gt;
  &amp;lt;assemblyIdentity
    type=&amp;#34;win32&amp;#34;
    name=&amp;#34;Microsoft.Windows.Common-Controls&amp;#34;
    version=&amp;#34;6.0.0.0&amp;#34;
    publicKeyToken=&amp;#34;6595b64144ccf1df&amp;#34;
    language=&amp;#34;*&amp;#34;
    processorArchitecture=&amp;#34;x86&amp;#34;/&amp;gt;
&amp;lt;/dependentAssembly&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;這差異會導致 common control 6.0 被使用，於是我們在開發人員的電腦採用這樣的 manifest 很快就重現這症狀了。現在問題是那裡的程式碼導致這樣的錯誤？由於當初猜測是 GDI 方面的問題，我們把 Windows Task Manager 叫出來，並且追蹤程式執行時的 GDI objects 數量，才赫然發現當問題發生前的一瞬間，GDI objects 的數量會暴增至 10000。此時我們很確定這是由 GDI leak 產生的問題，但對於為什麼換用新版的 common control 會導致這個 bug 卻是沒什麼頭緒。&lt;/p&gt;
&lt;p&gt;於是我們採用檢查問題發生點附近的程式碼，一邊單步執行一邊觀察 GDI Objects 的數量。用這樣的方法慢慢檢查，發現只要一呼叫 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/vclib/html/_mfc_cstatic.3a3a.setbitmap.asp&#34;&gt;CStatic::SetBitmap&lt;/a&gt;，就會有一個 GDI leak 產生。我們終於明瞭新版的 common control 對於 &lt;a href=&#34;http://msdn.microsoft.com/library/default.asp?url=https://blog.simplypatrick.com/library/en-us/shellcc/platform/commctls/staticcontrols/staticcontrolreference/staticcontrolmessages/stm_setimage.asp&#34;&gt;STM_SETIMAGE&lt;/a&gt; 有不一樣的處理方式：static control 有可能複製我們傳進去的 bitmap handle，因此我們有義務把傳回來的 bitmap handle 釋放掉。&lt;/p&gt;
&lt;p&gt;這個問題給我們的啟示是：當遇到瓶頸時，開發人員應該多&lt;b&gt;觀察&lt;/b&gt; (look)，不要瞎猜 (quit thinking。因為根據我的經驗，問題發生的原因往往超出你的想像，真的讓你矇上的機率非常地小。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>The n Habits of Highly Defective Windows Applications</title>
      <link>https://blog.simplypatrick.com/posts/2004/2004-04-01-139/</link>
      <pubDate>Thu, 01 Apr 2004 00:00:00 UTC</pubDate>
      <author>Patrick Tsai</author>
      <guid>https://blog.simplypatrick.com/posts/2004/2004-04-01-139/</guid>
      <description>&lt;p&gt;這篇文章《&lt;a href=&#34;http://www.flounder.com/badprogram.htm&#34;&gt;The &lt;i&gt;n&lt;/i&gt; Habits of Highly Defective Windows Applications&lt;/a&gt;》是上班時努力地 google，想要找出方法來解決一個 GDI leak 時，不小心發現的。文章點出了許多撰寫 Windows 程式的壞方法、壞習慣，裡面包含了許多我曾經犯過而且其他新手也常常在犯的錯誤。假如你想把 Windows programming 學好，你應該嚴肅地看待文章中提出的警告。&lt;/p&gt;
&lt;p&gt;文章作者對於 Win32 programming 相當有研究，他的其他相關的技術文章可以在 &lt;a href=&#34;http://www.flounder.com/mvp_tips.htm&#34;&gt;MVP Tips, Techniques, and Goodies&lt;/a&gt; 找到，篇篇精采。&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
